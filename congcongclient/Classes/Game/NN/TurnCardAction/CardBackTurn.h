#ifndef _CARD_BACK_H_
#define _CARD_BACK_H_

#include <cocos2d.h>
#include "CardTurnOption.h"

using namespace cocos2d;

namespace cardturn {

class TouchMathine;

class CardBackTurn
	: public Ref
{

public:

    CardBackTurn(Node* scene, 
		TouchMathine* state,
		std::string backMaterialPath,
		Vec2 basePos, 
		float scaleSize);

    virtual ~CardBackTurn();

protected:

    CardBackTurn();

public:
    
    //////////////////////////////////////////////////////////////////////////

    void init();
	//
	void update(float tt);
    //移动一定的距离
    void doMove(float fmove);
	//

	//////////////////////////////////////////////////////////////////////////

	bool onTouchBegin(Touch* touch, Event* ev);
	void onTouchMove(Touch* touch, Event* ev);
	void onTouchEnd(Touch* touch, Event* ev);
	void onTouchCancel(Touch* touch, Event* ev);

    //////////////////////////////////////////////////////////////////////////

protected:

	//////////////////////////////////////////////////////////////////////////

    //创建裁剪图形
    void ceateClipShape(CardTurn_Direction cdt_direction);


protected:

	//场景相关////////////////////////////////////////////////////////////////////////
    //Sence对象
    Node* _pScene;
    //基准坐标点
    Vec2 _basePos;
    //缩放比例
    float _scaleSize;
    //经过时间
    float _useTime;
    //用于裁剪的颜色
    Color4F _clipColor;
	//////////////////////////////////////////////////////////////////////////

	//牌背////////////////////////////////////////////////////////////////////////
    //图片路径
    std::string _materialPath;
    //卡片大小
    Rect _CardRect;
	//牌的背面
	Sprite3D* _cardBack;
	//材质
	Sprite3DMaterial* _mat;
	//////////////////////////////////////////////////////////////////////////

	//裁剪器////////////////////////////////////////////////////////////////////////
    //裁剪器
    ClippingNode* _pClipper;
	//裁剪图形的基准点
	Vec2 _clipBasePos;
    //用于裁剪背面的矩形顶点
    Vec2 _clipRect[CLIP_VERTEXT_SIZE];
    //用于裁剪的图形
    DrawNode* _pDrawNode;
    //裁剪器移动的距离
    float _cp_moved_offset;
	//半径
	float _fRadius;
	//////////////////////////////////////////////////////////////////////////

	//触摸相关////////////////////////////////////////////////////////////////////////
	//
	TouchMathine* _touch;
	//////////////////////////////////////////////////////////////////////////

};

}
#endif
